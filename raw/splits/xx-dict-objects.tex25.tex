====== Macro WITH-ACCESSORS ======


====Syntax====

\DefmacWithValuesNewline with-accessors {{\paren{\starparam{slot-entry}}} instance-form \starparam{declaration} \starparam{form}} {\starparam{result}}

\auxbnf{slot-entry}{\paren{variable-name accessor-name}}

====Arguments and Values====

//variable-name// - a //[[CL:Glossary:variable name]]//; \noeval.

//accessor-name// - a //[[CL:Glossary:function name]]//; \noeval.

//instance-form// - a //[[CL:Glossary:form]]//; \eval.

//declaration// - a \misc{declare} //[[CL:Glossary:expression]]//; \noeval.

//forms// - an //[[CL:Glossary:implicit progn]]//.

//results// - the //[[CL:Glossary:values]]// returned by the //forms//.

====Description====

Creates a lexical environment in which the slots specified by //slot-entry// are lexically available through their accessors as if they were variables. The macro **[[CL:Macros:with-accessors]]** invokes the appropriate accessors to //access// the //[[CL:Glossary:slots]]// specified by //slot-entry//. Both **[[CL:Macros:setf]]** and \specref{setq} can be used to set the value of the //[[CL:Glossary:slot]]//.

====Examples====

<blockquote> (defclass thing () ((x :initarg :x :accessor thing-x) (y :initarg :y :accessor thing-y))) → #<STANDARD-CLASS THING 250020173> (defmethod ([[CL:Macros:setf]] thing-x) :before (new-x (thing thing)) (format t "~&Changing X from ~D to ~D in ~S.~ (thing-x thing) new-x thing)) ([[CL:Macros:defparameter]] thing1 (make-instance 'thing :x 1 :y 2)) → #<THING 43135676> ([[CL:Macros:defparameter]] thing2 (make-instance 'thing :x 7 :y 8)) → #<THING 43147374> (with-accessors ((x1 thing-x) (y1 thing-y)) thing1 (with-accessors ((x2 thing-x) (y2 thing-y)) thing2 (list (list x1 (thing-x thing1) y1 (thing-y thing1) x2 (thing-x thing2) y2 (thing-y thing2)) ([[CL:Macros:defparameter]] x1 (+ y1 x2)) (list x1 (thing-x thing1) y1 (thing-y thing1) x2 (thing-x thing2) y2 (thing-y thing2)) ([[CL:Macros:setf]] (thing-x thing2) (list x1)) (list x1 (thing-x thing1) y1 (thing-y thing1) x2 (thing-x thing2) y2 (thing-y thing2)))))
▷ Changing X from 1 to 9 in #<THING 43135676>.
▷ Changing X from 7 to (9) in #<THING 43147374>. → ((1 1 2 2 7 7 8 8) 9 (9 9 2 2 7 7 8 8) (9) (9 9 2 2 (9) (9) 8 8)) </blockquote>

====Affected By====

**[[CL:Macros:defclass]]**

====Exceptional Situations====

The consequences are undefined if any //accessor-name// is not the name of an accessor for the //instance//.

====See Also====

**[[CL:Macros:with-slots]]**, \specref{symbol-macrolet}

====Notes====

A **[[CL:Macros:with-accessors]]** expression of the form:

''''\openup1\jot\vbox{\settabs\+\cr \+**[[CL:Functions:(with-accessors]]** (''{''slot-entry''}\sub 1 \ldots{''slot-entry''}\sub n'') ''instance-form'' ''{''form''}\sub 1 \ldots{''form''}\sub k'')\cr}''''

\noindent expands into the equivalent of

''''\openup1\jot\vbox{\settabs\+\cr \+**[[CL:Functions:(]]**&**[[CL:Functions:let ((]]**''in'' ''instance-form''**[[CL:Functions:))]]**\cr \+&**[[CL:Functions:(symbol-macrolet (]]**''{''Q''}\sub 1\ldots {''Q''}\sub n''**[[CL:Functions:)]]** ''{''form''}\sub 1 \ldots{''form''}\sub k''**[[CL:Functions:))]]**\cr}''''

\noindent where ''{''Q''}\sub i'' is

''''{\vbox{\hbox{**[[CL:Functions:(]]**''{''variable-name''}\sub i'' () {\tt (''{''accessor-name''}<sub>i</sub>\ in''))}}}}''''

\issue{DECLS-AND-DOC}
